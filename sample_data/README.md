# Sample Data Directory

このディレクトリには、入力解析用のサンプル動画ファイルを配置します。

## 動画ファイルの配置

mp4形式の動画ファイルをこのディレクトリに配置してください。

## 動画の要件

- **形式**: mp4（H.264コーデック推奨）
- **解像度**: 任意（解析領域設定時に読み込んだ動画の解像度がモデルに記録されます）
- **フレームレート**: 60 FPS（現在のアプリは60FPS向けに設計）
- **入力インジケータ領域**: アプリの「解析領域設定」メニューから設定
  - 指定サイズの正方形タイルを1列に並べた領域
  - 列数はユーザーが指定（方向キー1個 + ボタン最大5個 = 通常6列）
  - 継続フレーム数列は解析対象外（連続する同一入力を独自にカウント）

## 使用方法

### 1. 解析領域の設定（初回のみ）

GUIアプリの「解析領域設定」メニューから：

1. サンプル動画を読み込み
2. 入力インジケータ領域を指定：
   - 左上座標（X, Y）
   - タイルサイズ（正方形、例: 48×48ピクセル）
   - 列数（例: 6列 = 方向1 + ボタン5）
3. 設定を保存
   - モデルメタデータに動画解像度と領域情報が記録されます

### 2. GUIアプリで動画を解析

```powershell
# GUIアプリを起動
cargo run --bin input_editor_gui --features gui,ml --release
```

1. 「モデルを読み込む」から学習済みモデル（tar.gz）を選択
2. 「動画から抽出」から解析したい動画を選択
3. 自動的に入力履歴抽出が開始されます
   - フレーム抽出 → タイル切り出し → 推論 → 記録を1フレームずつ実行
   - プログレスバーで進捗をリアルタイム表示
4. 完了後、「CSVを保存」で結果を保存

### 3. 学習データの生成

GUIアプリの「学習データ生成」メニューを使用：

1. **入力動画**を選択（学習に使用するゲーム動画）
2. **出力先ルートディレクトリ**を指定（タイル画像の保存先）
3. **間引きフレーム数**を指定（例: 16 = 16フレームごとに抽出）
4. 「抽出開始」をクリック
5. 解析領域設定で指定したタイル領域からタイル画像が切り出されます
6. 出力先ディレクトリに以下の形式で保存されます：
   ```
   <動画ファイル名(拡張子なし)>_frame=<フレーム番号>_tile=<タイル番号>.png
   
   例：input_sample_06.mp4、間引きフレーム数16、タイル数6の場合
   input_sample_06_frame=0_tile=1.png
   input_sample_06_frame=0_tile=2.png
   input_sample_06_frame=0_tile=3.png
   ...
   input_sample_06_frame=0_tile=6.png
   input_sample_06_frame=16_tile=1.png
   input_sample_06_frame=16_tile=2.png
   ...
   input_sample_06_frame=32_tile=1.png
   ```

### 4. 学習データの仕分け

抽出されたタイル画像を手動で分類：

1. **学習ディレクトリを用意**（例: `training_data/`）
2. **直下に以下のディレクトリを作成**：
   ```
   training_data/
   ├── dir_1/          # 左下方向
   ├── dir_2/          # 下方向
   ├── dir_3/          # 右下方向
   ├── dir_4/          # 左方向
   ├── dir_6/          # 右方向
   ├── dir_7/          # 左上方向
   ├── dir_8/          # 上方向
   ├── dir_9/          # 右上方向
   ├── <ボタン名>/     # 解析したいボタンごとにディレクトリ作成（ユーザー指定）
   │                   # 例: btn_a1, btn_a2, btn_b, btn_w, btn_start など
   └── others/         # 上記のいずれにも分類されない画像
   ```
   ※ `dir_5`（ニュートラル）は作成しない
3. **タイル画像を仕分け**：
   - 先ほど抽出したタイル画像から各クラス**最低1枚ずつ**抽出
   - 該当するディレクトリに画像ファイルを移動またはコピー
   - 各クラス100枚以上推奨（精度向上のため）
4. 仕分け完了後、モデル学習ツールで学習を実行

### 5. モデルの評価と改善サイクル

学習したモデルの精度を向上させるための反復プロセス：

1. **タイル画像の自動分類**
   - GUIアプリの「タイル分類と確認」メニューを使用
   - 学習済みモデルで検証用動画のタイルを自動分類
   - 出力ディレクトリにクラスごとに分類された画像が保存される

2. **分類結果の確認と修正**
   - 出力ディレクトリの各クラスフォルダを確認
   - **特に誤分類されている画像を重点的にチェック**
   - 誤っているタイル画像を正しいクラスのディレクトリに移動

3. **学習データへの統合**
   - 修正したタイル画像を`training_data/`の各クラスディレクトリに追加
   - より大きく、より正確なデータセットを構築

4. **再学習**
   - 改善したデータセットで再度モデルを学習
   - 学習→分類→確認→修正→再学習のサイクルを繰り返す

5. **精度確認**
   - 任意の動画に対して誤分類が少なくなるまで繰り返す
   - **十分な精度が出たらモデル完成**
   - 入力履歴抽出でも高い精度を発揮します

## .gitignore の設定

動画ファイルは`.gitignore`で除外されているため、Gitリポジトリには含まれません。
各自で動画ファイルを用意してこのディレクトリに配置してください。

## 注意事項

- 動画ファイルは大容量になるため、Gitで管理しないでください
- バックアップは別途行うことを推奨します
- プライバシーに配慮し、個人情報が含まれる動画は使用しないでください
- 解像度が1920x1080以外の動画は、モデル学習時に使用した解像度と一致させる必要があります