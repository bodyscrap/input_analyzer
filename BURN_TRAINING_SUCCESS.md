# Burnå­¦ç¿’æˆåŠŸãƒ¬ãƒãƒ¼ãƒˆ ğŸ”¥

## æ¦‚è¦

Burn 0.19.1 + NdArray (CPU) ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€48x48ã®ã‚²ãƒ¼ãƒ å…¥åŠ›ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒã‚’14ã‚¯ãƒ©ã‚¹ã«åˆ†é¡ã™ã‚‹CNNãƒ¢ãƒ‡ãƒ«ã®å­¦ç¿’ã«æˆåŠŸã—ã¾ã—ãŸã€‚

## å­¦ç¿’çµæœ

### æœ€çµ‚ç²¾åº¦ï¼ˆ5ã‚¨ãƒãƒƒã‚¯ï¼‰

| ãƒ¡ãƒˆãƒªãƒƒã‚¯ | å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ | æ¤œè¨¼ãƒ‡ãƒ¼ã‚¿ |
|-----------|-----------|-----------|
| **Accuracy** | **99.732%** | **98.929%** |
| **Loss** | 0.015 | 0.039 |

### ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ

- **ç·ã‚µãƒ³ãƒ—ãƒ«æ•°**: 1,400æš
- **å­¦ç¿’ãƒ‡ãƒ¼ã‚¿**: 1,120æš (80%)
- **æ¤œè¨¼ãƒ‡ãƒ¼ã‚¿**: 280æš (20%)
- **ã‚¯ãƒ©ã‚¹æ•°**: 14
  - æ–¹å‘å…¥åŠ›: 8ç¨®é¡ (dir_1, dir_2, dir_3, dir_4, dir_6, dir_7, dir_8, dir_9)
  - ãƒœã‚¿ãƒ³: 5ç¨®é¡ (btn_a1, btn_a2, btn_b, btn_start, btn_w)
  - ç©ºç™½: 1ç¨®é¡ (empty)

### ã‚¯ãƒ©ã‚¹åˆ¥ã‚µãƒ³ãƒ—ãƒ«æ•°

| ã‚¯ãƒ©ã‚¹ | æšæ•° |
|--------|------|
| btn_a1 | 100 |
| btn_a2 | 100 |
| btn_b | 100 |
| btn_start | 100 |
| btn_w | 100 |
| dir_1 | 100 |
| dir_2 | 100 |
| dir_3 | 100 |
| dir_4 | 100 |
| dir_6 | 100 |
| dir_7 | 100 |
| dir_8 | 99 |
| dir_9 | 69 |
| empty | 132 |

## ãƒ¢ãƒ‡ãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### CNNãƒ¢ãƒ‡ãƒ«æ§‹é€ 

```
å…¥åŠ›: 48x48x3 (RGBç”»åƒ)

Conv1 Block (48x48 â†’ 24x24):
  - Conv2d: 3 â†’ 32, kernel=3x3, padding=1
  - ReLU
  - Conv2d: 32 â†’ 32, kernel=3x3, padding=1
  - ReLU
  - MaxPool2d: 2x2

Conv2 Block (24x24 â†’ 12x12):
  - Conv2d: 32 â†’ 64, kernel=3x3, padding=1
  - ReLU
  - Conv2d: 64 â†’ 64, kernel=3x3, padding=1
  - ReLU
  - MaxPool2d: 2x2

Conv3 Block (12x12 â†’ 6x6):
  - Conv2d: 64 â†’ 128, kernel=3x3, padding=1
  - ReLU
  - Conv2d: 128 â†’ 128, kernel=3x3, padding=1
  - ReLU
  - MaxPool2d: 2x2

Fully Connected:
  - Flatten: 128*6*6 = 4,608
  - Dropout: 0.5
  - Linear: 4,608 â†’ 256
  - ReLU
  - Dropout: 0.3
  - Linear: 256 â†’ 14

å‡ºåŠ›: 14ã‚¯ãƒ©ã‚¹ã®ãƒ­ã‚¸ãƒƒãƒˆ
```

### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•°

- **ç·ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•°**: 1,470,510
  - conv1_1: 896
  - conv1_2: 9,248
  - conv2_1: 18,496
  - conv2_2: 36,928
  - conv3_1: 73,856
  - conv3_2: 147,584
  - fc1: 1,179,904
  - fc2: 3,598

## å­¦ç¿’è¨­å®š

### ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å€¤ |
|-----------|-----|
| ã‚¨ãƒãƒƒã‚¯æ•° | 5 |
| ãƒãƒƒãƒã‚µã‚¤ã‚º | 16 |
| å­¦ç¿’ç‡ | 0.001 |
| Optimizer | Adam |
| æå¤±é–¢æ•° | CrossEntropy |
| Dropout | 0.5 (FC1), 0.3 (FC2) |

### ãƒ‡ãƒ¼ã‚¿æ‹¡å¼µ

å­¦ç¿’æ™‚ã¯ä»¥ä¸‹ã®æ‹¡å¼µãªã—ï¼ˆä»Šå¾Œè¿½åŠ å¯èƒ½ï¼‰:
- ãªã—ï¼ˆæ­£è¦åŒ–ã®ã¿ï¼‰

### æ­£è¦åŒ–

ImageNetã®å¹³å‡ã¨æ¨™æº–åå·®ã‚’ä½¿ç”¨:
- Mean: [0.485, 0.456, 0.406]
- Std: [0.229, 0.224, 0.225]

## å®Ÿè£…ã®ç‰¹å¾´

### ãƒ¡ãƒ¢ãƒªåŠ¹ç‡çš„ãªè¨­è¨ˆ

âœ… **é…å»¶ãƒ­ãƒ¼ãƒ‰æ–¹å¼**
- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿æ™‚ã¯ç”»åƒãƒ‘ã‚¹ã®ã¿ã‚’ä¿æŒ
- ãƒãƒƒãƒç”Ÿæˆæ™‚ã«ã®ã¿ç”»åƒã‚’ãƒ­ãƒ¼ãƒ‰
- ãƒãƒƒãƒå‡¦ç†å®Œäº†å¾Œã¯è‡ªå‹•çš„ã«ãƒ¡ãƒ¢ãƒªè§£æ”¾

```rust
// IconItemã¯ç”»åƒãƒ‘ã‚¹ã®ã¿ã‚’ä¿æŒ
struct IconItem {
    path: PathBuf,
    label: usize,
}

// ãƒãƒƒãƒç”Ÿæˆæ™‚ã«ç”»åƒã‚’ãƒ­ãƒ¼ãƒ‰
impl Batcher<B, IconItem, IconBatch<B>> for IconBatcher<B> {
    fn batch(&self, items: Vec<IconItem>, device: &B::Device) -> IconBatch<B> {
        for item in items {
            match load_image(&item.path) {
                Ok(image_data) => { /* ä½¿ç”¨ */ }
                Err(e) => { /* ã‚¨ãƒ©ãƒ¼å‡¦ç† */ }
            }
        }
        // â† ã“ã“ã§ãƒ¡ãƒ¢ãƒªè‡ªå‹•è§£æ”¾
    }
}
```

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®é¸æŠ

#### CPUãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (NdArray) - ç¾åœ¨ä½¿ç”¨ä¸­

```rust
type MyBackend = burn_ndarray::NdArray<f32>;
type MyAutodiffBackend = burn_autodiff::Autodiff<MyBackend>;
```

**åˆ©ç‚¹:**
- ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ãŒè‰¯ã„
- ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒç°¡å˜
- ãƒ‡ãƒãƒƒã‚°ã—ã‚„ã™ã„
- å°è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§ååˆ†é«˜é€Ÿ

**ä½¿ç”¨ä¾‹:**
```bash
cargo run --bin train_model --features ml --release -- training_data 50 16
```

#### WGPUãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (GPU) - ã‚ªãƒ—ã‚·ãƒ§ãƒ³

```rust
type MyBackend = burn_wgpu::Wgpu;
type MyAutodiffBackend = burn_autodiff::Autodiff<MyBackend>;
```

**åˆ©ç‚¹:**
- å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§é«˜é€Ÿ
- ãƒãƒƒãƒã‚µã‚¤ã‚ºã‚’å¤§ããã§ãã‚‹

**è¦ä»¶:**
- GPU (NVIDIA/AMD/Intel)
- Vulkan ã¾ãŸã¯ DirectX 12

## å­¦ç¿’ã‚³ãƒãƒ³ãƒ‰

### åŸºæœ¬çš„ãªå­¦ç¿’

```bash
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šï¼ˆã‚¨ãƒãƒƒã‚¯æ•°è‡ªå‹•ï¼‰
cargo run --bin train_model --features ml --release -- training_data

# ã‚¨ãƒãƒƒã‚¯æ•°ã‚’æŒ‡å®š
cargo run --bin train_model --features ml --release -- training_data 50

# ã‚¨ãƒãƒƒã‚¯æ•°ã¨ãƒãƒƒãƒã‚µã‚¤ã‚ºã‚’æŒ‡å®š
cargo run --bin train_model --features ml --release -- training_data 50 32
```

### å‡ºåŠ›

- ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«: `models/model`
- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«: `models/config.json`
- å­¦ç¿’ãƒ­ã‚°: `models/experiment.log`
- ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ: `models/checkpoints/`

## ãƒ¢ãƒ‡ãƒ«ã®ä½¿ç”¨æ–¹æ³•

### ãƒ¢ãƒ‡ãƒ«ã®ãƒ­ãƒ¼ãƒ‰

```rust
use burn::record::{CompactRecorder, Recorder};

// ãƒ¢ãƒ‡ãƒ«è¨­å®š
let model_config = ModelConfig::new(14);

// ãƒ‡ãƒã‚¤ã‚¹è¨­å®š
let device = burn_ndarray::NdArrayDevice::Cpu;

// ãƒ¢ãƒ‡ãƒ«åˆæœŸåŒ–
let mut model = model_config.init::<MyBackend>(&device);

// å­¦ç¿’æ¸ˆã¿é‡ã¿ã‚’ãƒ­ãƒ¼ãƒ‰
model = model
    .load_file("models/model", &CompactRecorder::new(), &device)
    .expect("ãƒ¢ãƒ‡ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—");
```

### æ¨è«–

```rust
// ç”»åƒã‚’ãƒ­ãƒ¼ãƒ‰ï¼ˆ48x48 RGBï¼‰
let image_data = load_image(&image_path)?;

// Tensorã«å¤‰æ› [1, 3, 48, 48]
let images = Tensor::<MyBackend, 1>::from_floats(image_data.as_slice(), &device)
    .reshape([1, 3, 48, 48]);

// æ¨è«–
let output = model.forward(images);
let prediction = output.argmax(1);

// ã‚¯ãƒ©ã‚¹åã‚’å–å¾—
let class_idx = prediction.into_scalar() as usize;
let class_name = CLASS_NAMES[class_idx];
```

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### 1. ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ã£ãŸæ–°ã—ã„ãƒ‡ãƒ¼ã‚¿åé›†

å­¦ç¿’ã—ãŸãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ã£ã¦ã€`input_cells_all` ã‹ã‚‰é«˜å“è³ªãªã‚µãƒ³ãƒ—ãƒ«ã‚’è‡ªå‹•åé›†:

```bash
cargo run --bin collect_with_model --features ml --release -- \
    --input input_cells_all \
    --output training_data \
    --target 150 \
    --confidence 0.95
```

### 2. åå¾©å­¦ç¿’ã§ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆå“è³ªã‚’å‘ä¸Š

```
1. ç¾åœ¨ã®training_dataã§ãƒ¢ãƒ‡ãƒ«ã‚’å­¦ç¿’
2. å­¦ç¿’ã—ãŸãƒ¢ãƒ‡ãƒ«ã§input_cells_allã‹ã‚‰é«˜ä¿¡é ¼åº¦ã‚µãƒ³ãƒ—ãƒ«ã‚’åé›†
3. training_dataã‚’æ›´æ–°
4. å†åº¦å­¦ç¿’ï¼ˆç²¾åº¦å‘ä¸Šï¼‰
```

### 3. ã‚ˆã‚Šé•·ã„ã‚¨ãƒãƒƒã‚¯ã§ã®å­¦ç¿’

```bash
# 50ã‚¨ãƒãƒƒã‚¯ã§å­¦ç¿’
cargo run --bin train_model --features ml --release -- training_data 50 32
```

### 4. ãƒ‡ãƒ¼ã‚¿æ‹¡å¼µã®è¿½åŠ 

- æ°´å¹³ãƒ•ãƒªãƒƒãƒ—
- è‰²èª¿æ•´
- å›è»¢ï¼ˆå°è§’åº¦ï¼‰
- ãƒã‚¤ã‚ºè¿½åŠ 

### 5. ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°

- å­¦ç¿’ç‡ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©
- ã‚ˆã‚Šæ·±ã„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯
- ç•°ãªã‚‹Dropoutç‡
- ãƒãƒƒãƒã‚µã‚¤ã‚ºã®èª¿æ•´

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ¡ãƒ¢ãƒªä¸è¶³

```bash
# ãƒãƒƒãƒã‚µã‚¤ã‚ºã‚’å°ã•ã
cargo run --bin train_model --features ml --release -- training_data 30 8
```

### å­¦ç¿’ãŒé…ã„

- WGPUãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆï¼ˆGPUä½¿ç”¨ï¼‰
- ãƒãƒƒãƒã‚µã‚¤ã‚ºã‚’å¤§ããï¼ˆGPUä½¿ç”¨æ™‚ï¼‰
- num_workersã‚’èª¿æ•´

### ç²¾åº¦ãŒä¸ŠãŒã‚‰ãªã„

- ã‚¨ãƒãƒƒã‚¯æ•°ã‚’å¢—ã‚„ã™
- ãƒ‡ãƒ¼ã‚¿æ‹¡å¼µã‚’è¿½åŠ 
- ã‚ˆã‚Šå¤šãã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’åé›†
- å­¦ç¿’ç‡ã‚’èª¿æ•´

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
input_analyzer/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ bin/
â”‚       â””â”€â”€ train_model.rs          # å­¦ç¿’ã‚¹ã‚¯ãƒªãƒ—ãƒˆ (1,470,510ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿)
â”œâ”€â”€ training_data/                  # ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ (1,400æš)
â”‚   â”œâ”€â”€ btn_a1/                     # 100æš
â”‚   â”œâ”€â”€ btn_a2/                     # 100æš
â”‚   â”œâ”€â”€ btn_b/                      # 100æš
â”‚   â”œâ”€â”€ btn_start/                  # 100æš
â”‚   â”œâ”€â”€ btn_w/                      # 100æš
â”‚   â”œâ”€â”€ dir_1/                      # 100æš
â”‚   â”œâ”€â”€ dir_2/                      # 100æš
â”‚   â”œâ”€â”€ dir_3/                      # 100æš
â”‚   â”œâ”€â”€ dir_4/                      # 100æš
â”‚   â”œâ”€â”€ dir_6/                      # 100æš
â”‚   â”œâ”€â”€ dir_7/                      # 100æš
â”‚   â”œâ”€â”€ dir_8/                      # 99æš
â”‚   â”œâ”€â”€ dir_9/                      # 69æš
â”‚   â”œâ”€â”€ empty/                      # 132æš
â”‚   â””â”€â”€ labels.txt
â”œâ”€â”€ models/                         # å­¦ç¿’æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«
â”‚   â”œâ”€â”€ model                       # ãƒ¢ãƒ‡ãƒ«é‡ã¿ (CompactRecorderå½¢å¼)
â”‚   â”œâ”€â”€ config.json                 # ãƒ¢ãƒ‡ãƒ«è¨­å®š
â”‚   â”œâ”€â”€ experiment.log              # å­¦ç¿’ãƒ­ã‚°
â”‚   â””â”€â”€ checkpoints/                # ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ
â””â”€â”€ input_cells_all/                # å…¨ã‚»ãƒ«ç”»åƒ (574,752æš)
    â”œâ”€â”€ input_sample_01/
    â”œâ”€â”€ input_sample_02/
    â”œâ”€â”€ input_sample_03/
    â”œâ”€â”€ input_sample_04/
    â”œâ”€â”€ input_sample_05/
    â”œâ”€â”€ input_sample_06/
    â””â”€â”€ input_sample_07/
```

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **Burn**: 0.19.1 (æ·±å±¤å­¦ç¿’ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯)
- **Backend**: NdArray (CPU)
- **Optimizer**: Adam
- **Loss**: CrossEntropy
- **Image**: 0.25
- **Rand**: 0.8

## ã¾ã¨ã‚

âœ… **å­¦ç¿’æˆåŠŸ**: æ¤œè¨¼ç²¾åº¦ **98.929%** ã‚’é”æˆ  
âœ… **ãƒ¡ãƒ¢ãƒªåŠ¹ç‡**: é…å»¶ãƒ­ãƒ¼ãƒ‰æ–¹å¼ã§å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã«ã‚‚å¯¾å¿œ  
âœ… **ç´”ç²‹Rust**: Burn + NdArrayã§å®Œå…¨ã«Rustã§å®Ÿè£…  
âœ… **æœ¬ç•ªæº–å‚™å®Œäº†**: ãƒ¢ãƒ‡ãƒ«ã¯ `models/model` ã«ä¿å­˜æ¸ˆã¿  

æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¨ã—ã¦ã€ã“ã®ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ã£ã¦ `input_cells_all` (574,752æš) ã‹ã‚‰é«˜å“è³ªãªã‚µãƒ³ãƒ—ãƒ«ã‚’è‡ªå‹•åé›†ã—ã€ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’æ‹¡å……ã§ãã¾ã™ã€‚

---

**ä½œæˆæ—¥**: 2025-11-23  
**Burnãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 0.19.1  
**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: NdArray (CPU)  
**å­¦ç¿’æ™‚é–“**: ç´„5-10åˆ† (5ã‚¨ãƒãƒƒã‚¯ã€ãƒãƒƒãƒã‚µã‚¤ã‚º16)